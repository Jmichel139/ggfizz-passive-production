<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>GG Fizz ASA Passive Production</title>

    <!-- Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Lato&display=swap" rel="stylesheet" />
    <link rel="shortcut icon" type="image/png"
        href="https://upload.gameserverapp.com/yF4DRuPvWHu2VSL66x2ENTECR2jLP097xbnpXllu.png" />
    <!-- CSS -->
    <link rel="stylesheet" href="styles.css" />
</head>

<body>

    <!-- Background -->
    <div class="full-bg"></div>

    <!-- Navbar -->
    <!-- <nav class="navbar">
        <div class="navbar-inner">
            <a class="navbar-logo" href="/">
                <h1>GG Fizz</h1>
            </a>
            <button class="menu-toggle" aria-label="Menu">&#9776;</button>
            <ul class="navbar-links">
                <li><a href="#">Home</a></li>
                <li><a href="#">Rules</a></li>
                <li><a href="#">Discord</a></li>
            </ul>
        </div>
    </nav> -->

    <div class="menu-wrapper">
        <img class="menu-left" src="img/menu/menu-left.png" alt="menu-left" />
        <div class="menu-repeat"></div>
        <img class="menu-right" src="img/menu/menu-right.png" alt="menu-right" />
    </div>

    <!-- Main Content -->
    <main class="content-container">
        <div class="welcome-box">
            <h1>GG Fizz ASA Passive Production</h1>
            <p>Welcome to the GG Fizz ASA Passive Production page. Here you can find all the information you need about
                our passive production system.</p>
            <p>Stay tuned for updates and more features coming soon!</p>
        </div>
        <div class="json-display">
            <div class="dropdown-container">
                <label for="creatureSelect">Select Creature:</label>
                <select id="creatureSelect">
                    <option value="">-- Choose a Creature --</option>
                </select>
            </div>

            <div class="dropdown-container">
                <label for="resourceSelect">Select Resource:</label>
                <select id="resourceSelect">
                    <option value="">-- Choose a Resource --</option>
                </select>
            </div>

            <div id="results" class="results-box">
                <!-- Results will display here -->
            </div>
        </div>

    </main>

    <!-- Footer -->
    <footer class="site-footer">
        <p>&copy; 2025 CaotcAftermth. All rights reserved.</p>
    </footer>



    <script>
        const creatureSelect = document.getElementById("creatureSelect");
        const resourceSelect = document.getElementById("resourceSelect");
        const resultsBox = document.getElementById("results");

        let creatureMap = new Map(); // { creatureName → [resourceNames] }
        let resourceMap = new Map(); // { resourceName → [creatureNames] }

        function extractNameFromBPPath(bpPath) {
            const parts = bpPath.split('/');
            const rawName = parts[parts.length - 1].split('.')[0];
            // Remove common suffixes like _Character_BP or PrimalItem
            return rawName
                .replace(/(_Character_BP_C?|_Character)?$/i, '')
                .replace(/^PrimalItem(Consumable|Resource|Ammo|Structure)?_?/i, '')
                .replace(/_/g, ' ');
        }

        function addToMap(map, key, value) {
            if (!map.has(key)) {
                map.set(key, new Set());
            }
            map.get(key).add(value);
        }

        fetch("https://pastebin.com/raw/UQcr96Vw")
            .then(res => res.json())
            .then(data => {
                data.forEach(entry => {
                    const creatureName = extractNameFromBPPath(entry.dinoType);

                    const allItems = [];

                    entry.produces.forEach(prod => {
                        prod.items.forEach(item => {
                            if (item.bpPath) {
                                allItems.push(item.bpPath);
                            }

                            if (Array.isArray(item.alternateItems)) {
                                item.alternateItems.forEach(alt => {
                                    if (alt.bpPath) {
                                        allItems.push(alt.bpPath);
                                    }
                                });
                            }
                        });
                    });

                    const resourceNames = allItems.map(extractNameFromBPPath);

                    creatureMap.set(creatureName, resourceNames);
                    resourceNames.forEach(resource => {
                        addToMap(resourceMap, resource, creatureName);
                    });
                });

                // Populate Creature Dropdown
                Array.from(creatureMap.keys()).sort().forEach(creature => {
                    const opt = document.createElement("option");
                    opt.value = creature;
                    opt.textContent = creature;
                    creatureSelect.appendChild(opt);
                });

                // Populate Resource Dropdown
                Array.from(resourceMap.keys()).sort().forEach(resource => {
                    const opt = document.createElement("option");
                    opt.value = resource;
                    opt.textContent = resource;
                    resourceSelect.appendChild(opt);
                });
            });

        creatureSelect.addEventListener("change", () => {
            resourceSelect.value = "";
            const creature = creatureSelect.value;
            if (creature && creatureMap.has(creature)) {
                const resources = Array.from(creatureMap.get(creature)).sort();
                resultsBox.innerHTML = `
      <strong>${creature}</strong> passively produces:
      <ul>${resources.map(r => `<li>${r}</li>`).join('')}</ul>
    `;
            } else {
                resultsBox.innerHTML = "";
            }
        });

        resourceSelect.addEventListener("change", () => {
            creatureSelect.value = "";
            const resource = resourceSelect.value;
            if (resource && resourceMap.has(resource)) {
                const creatures = Array.from(resourceMap.get(resource)).sort();
                resultsBox.innerHTML = `
      <strong>${resource}</strong> is passively produced by:
      <ul>${creatures.map(c => `<li>${c}</li>`).join('')}</ul>
    `;
            } else {
                resultsBox.innerHTML = "";
            }
        });
    </script>


</body>

</html>